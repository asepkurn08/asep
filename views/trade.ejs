<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade - InvestHub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">
                <i class="fas fa-chart-line me-2"></i>InvestHub
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home me-1"></i>Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/portfolio"><i class="fas fa-briefcase me-1"></i>Portfolio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/market"><i class="fas fa-chart-bar me-1"></i>Market</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/trade"><i class="fas fa-exchange-alt me-1"></i>Trade</a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <% if (user) { %>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user me-1"></i><%= user.name %>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="/profile">Profile</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="/logout">Logout</a></li>
                            </ul>
                        </li>
                    <% } else { %>
                        <li class="nav-item">
                            <a class="nav-link" href="/login"><i class="fas fa-sign-in-alt me-1"></i>Login</a>
                        </li>
                    <% } %>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Trading Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card bg-gradient-success text-white">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h2 class="mb-2"><i class="fas fa-exchange-alt me-2"></i>Trading Center</h2>
                                <p class="mb-0">Execute trades with real-time market data and advanced order types</p>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="d-flex justify-content-end">
                                    <div class="me-3">
                                        <small>Buying Power</small>
                                        <h5 class="mb-0">$45,230.50</h5>
                                    </div>
                                    <div>
                                        <small>Day Trading Power</small>
                                        <h5 class="mb-0">$180,922.00</h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Trading Form -->
            <div class="col-lg-4 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="tradeTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="buy-tab" data-bs-toggle="tab" data-bs-target="#buy" type="button" role="tab">
                                    <i class="fas fa-plus-circle me-1"></i>Buy
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="sell-tab" data-bs-toggle="tab" data-bs-target="#sell" type="button" role="tab">
                                    <i class="fas fa-minus-circle me-1"></i>Sell
                                </button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="tradeTabContent">
                            <!-- Buy Tab -->
                            <div class="tab-pane fade show active" id="buy" role="tabpanel">
                                <form id="buyForm">
                                    <div class="mb-3">
                                        <label for="buySymbol" class="form-label">Symbol</label>
                                        <input type="text" class="form-control" id="buySymbol" placeholder="e.g., AAPL" required>
                                        <div class="form-text">Enter stock symbol to trade</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="buyOrderType" class="form-label">Order Type</label>
                                        <select class="form-select" id="buyOrderType">
                                            <option value="market">Market Order</option>
                                            <option value="limit">Limit Order</option>
                                            <option value="stop">Stop Order</option>
                                            <option value="stop-limit">Stop-Limit Order</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3" id="buyLimitPrice" style="display: none;">
                                        <label for="buyPrice" class="form-label">Limit Price</label>
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number" class="form-control" id="buyPrice" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="buyQuantity" class="form-label">Quantity</label>
                                        <input type="number" class="form-control" id="buyQuantity" min="1" placeholder="Number of shares" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="buyDuration" class="form-label">Duration</label>
                                        <select class="form-select" id="buyDuration">
                                            <option value="day">Day Order</option>
                                            <option value="gtc">Good Till Canceled</option>
                                            <option value="ioc">Immediate or Cancel</option>
                                            <option value="fok">Fill or Kill</option>
                                        </select>
                                    </div>
                                    
                                    <div class="alert alert-info">
                                        <small><strong>Estimated Cost:</strong> <span id="buyEstimate">$0.00</span></small>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-success btn-lg w-100">
                                        <i class="fas fa-shopping-cart me-2"></i>Place Buy Order
                                    </button>
                                </form>
                            </div>
                            
                            <!-- Sell Tab -->
                            <div class="tab-pane fade" id="sell" role="tabpanel">
                                <form id="sellForm">
                                    <div class="mb-3">
                                        <label for="sellSymbol" class="form-label">Symbol</label>
                                        <input type="text" class="form-control" id="sellSymbol" placeholder="e.g., AAPL" required>
                                        <div class="form-text">Enter stock symbol to sell</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="sellOrderType" class="form-label">Order Type</label>
                                        <select class="form-select" id="sellOrderType">
                                            <option value="market">Market Order</option>
                                            <option value="limit">Limit Order</option>
                                            <option value="stop">Stop Order</option>
                                            <option value="stop-limit">Stop-Limit Order</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3" id="sellLimitPrice" style="display: none;">
                                        <label for="sellPrice" class="form-label">Limit Price</label>
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number" class="form-control" id="sellPrice" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="sellQuantity" class="form-label">Quantity</label>
                                        <input type="number" class="form-control" id="sellQuantity" min="1" placeholder="Number of shares" required>
                                        <div class="form-text">Available: <span id="availableShares">0</span> shares</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="sellDuration" class="form-label">Duration</label>
                                        <select class="form-select" id="sellDuration">
                                            <option value="day">Day Order</option>
                                            <option value="gtc">Good Till Canceled</option>
                                            <option value="ioc">Immediate or Cancel</option>
                                            <option value="fok">Fill or Kill</option>
                                        </select>
                                    </div>
                                    
                                    <div class="alert alert-warning">
                                        <small><strong>Estimated Proceeds:</strong> <span id="sellEstimate">$0.00</span></small>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-danger btn-lg w-100">
                                        <i class="fas fa-hand-holding-usd me-2"></i>Place Sell Order
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Market Watch -->
            <div class="col-lg-8 mb-4">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-eye me-2"></i>Market Watch</h5>
                        <button class="btn btn-outline-primary btn-sm" onclick="addToWatchlist()">
                            <i class="fas fa-plus me-1"></i>Add Symbol
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Symbol</th>
                                        <th>Company</th>
                                        <th>Last Price</th>
                                        <th>Change</th>
                                        <th>% Change</th>
                                        <th>Volume</th>
                                        <th>52W High</th>
                                        <th>52W Low</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>AAPL</strong></td>
                                        <td>Apple Inc.</td>
                                        <td>$185.25</td>
                                        <td class="text-success">+2.45</td>
                                        <td class="text-success">+1.34%</td>
                                        <td>45.2M</td>
                                        <td>$195.89</td>
                                        <td>$124.17</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-success" onclick="quickTrade('AAPL', 'buy')">Buy</button>
                                                <button class="btn btn-outline-danger" onclick="quickTrade('AAPL', 'sell')">Sell</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>GOOGL</strong></td>
                                        <td>Alphabet Inc.</td>
                                        <td>$142.80</td>
                                        <td class="text-danger">-1.20</td>
                                        <td class="text-danger">-0.83%</td>
                                        <td>28.7M</td>
                                        <td>$152.10</td>
                                        <td>$83.34</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-success" onclick="quickTrade('GOOGL', 'buy')">Buy</button>
                                                <button class="btn btn-outline-danger" onclick="quickTrade('GOOGL', 'sell')">Sell</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>MSFT</strong></td>
                                        <td>Microsoft Corp.</td>
                                        <td>$378.90</td>
                                        <td class="text-success">+5.60</td>
                                        <td class="text-success">+1.50%</td>
                                        <td>32.1M</td>
                                        <td>$384.30</td>
                                        <td>$212.43</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-success" onclick="quickTrade('MSFT', 'buy')">Buy</button>
                                                <button class="btn btn-outline-danger" onclick="quickTrade('MSFT', 'sell')">Sell</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>TSLA</strong></td>
                                        <td>Tesla Inc.</td>
                                        <td>$248.50</td>
                                        <td class="text-success">+8.25</td>
                                        <td class="text-success">+3.44%</td>
                                        <td>156.8M</td>
                                        <td>$299.29</td>
                                        <td>$101.81</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-success" onclick="quickTrade('TSLA', 'buy')">Buy</button>
                                                <button class="btn btn-outline-danger" onclick="quickTrade('TSLA', 'sell')">Sell</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>AMZN</strong></td>
                                        <td>Amazon.com Inc.</td>
                                        <td>$156.75</td>
                                        <td class="text-danger">-2.10</td>
                                        <td class="text-danger">-1.32%</td>
                                        <td>41.3M</td>
                                        <td>$170.00</td>
                                        <td>$81.43</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-success" onclick="quickTrade('AMZN', 'buy')">Buy</button>
                                                <button class="btn btn-outline-danger" onclick="quickTrade('AMZN', 'sell')">Sell</button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Orders -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-history me-2"></i>Recent Orders</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Symbol</th>
                                        <th>Side</th>
                                        <th>Quantity</th>
                                        <th>Price</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="ordersTable">
                                    <tr>
                                        <td>Today 10:30 AM</td>
                                        <td><strong>AAPL</strong></td>
                                        <td><span class="badge bg-success">Buy</span></td>
                                        <td>100</td>
                                        <td>$184.50</td>
                                        <td>Market</td>
                                        <td><span class="badge bg-success">Filled</span></td>
                                        <td>
                                            <button class="btn btn-outline-secondary btn-sm">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Today 09:15 AM</td>
                                        <td><strong>TSLA</strong></td>
                                        <td><span class="badge bg-danger">Sell</span></td>
                                        <td>25</td>
                                        <td>$245.00</td>
                                        <td>Limit</td>
                                        <td><span class="badge bg-warning">Pending</span></td>
                                        <td>
                                            <button class="btn btn-outline-danger btn-sm" onclick="cancelOrder('TSLA001')">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4 mt-5">
        <div class="container">
            <p class="mb-0">&copy; 2024 InvestHub. Platform investasi modern untuk masa depan yang lebih baik.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Order type change handlers
        document.getElementById('buyOrderType').addEventListener('change', function() {
            const limitDiv = document.getElementById('buyLimitPrice');
            limitDiv.style.display = (this.value === 'limit' || this.value === 'stop-limit') ? 'block' : 'none';
        });

        document.getElementById('sellOrderType').addEventListener('change', function() {
            const limitDiv = document.getElementById('sellLimitPrice');
            limitDiv.style.display = (this.value === 'limit' || this.value === 'stop-limit') ? 'block' : 'none';
        });

        // Form handlers
        document.getElementById('buyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = {
                action: 'buy',
                symbol: document.getElementById('buySymbol').value,
                quantity: document.getElementById('buyQuantity').value,
                orderType: document.getElementById('buyOrderType').value,
                price: document.getElementById('buyPrice').value,
                duration: document.getElementById('buyDuration').value
            };
            submitOrder(formData);
        });

        document.getElementById('sellForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = {
                action: 'sell',
                symbol: document.getElementById('sellSymbol').value,
                quantity: document.getElementById('sellQuantity').value,
                orderType: document.getElementById('sellOrderType').value,
                price: document.getElementById('sellPrice').value,
                duration: document.getElementById('sellDuration').value
            };
            submitOrder(formData);
        });

        function submitOrder(data) {
            fetch('/api/trade', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert(`Order submitted successfully! Order ID: ${result.orderId}`);
                    // Reset form and update orders table
                    document.getElementById(data.action + 'Form').reset();
                    updateOrdersTable(data, result.orderId);
                } else {
                    alert('Error submitting order: ' + result.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error submitting order');
            });
        }

        function quickTrade(symbol, action) {
            if (action === 'buy') {
                document.getElementById('buySymbol').value = symbol;
                document.querySelector('#buy-tab').click();
            } else {
                document.getElementById('sellSymbol').value = symbol;
                document.querySelector('#sell-tab').click();
            }
        }

        function addToWatchlist() {
            const symbol = prompt('Enter stock symbol to add to watchlist:');
            if (symbol) {
                alert(`${symbol} added to watchlist!`);
            }
        }

        function cancelOrder(orderId) {
            if (confirm('Are you sure you want to cancel this order?')) {
                alert('Order cancelled successfully!');
                // Remove from table or update status
            }
        }

        function updateOrdersTable(orderData, orderId) {
            const tbody = document.getElementById('ordersTable');
            const row = tbody.insertRow(0);
            const now = new Date();
            row.innerHTML = `
                <td>Today ${now.toLocaleTimeString()}</td>
                <td><strong>${orderData.symbol}</strong></td>
                <td><span class="badge bg-${orderData.action === 'buy' ? 'success' : 'danger'}">${orderData.action.charAt(0).toUpperCase() + orderData.action.slice(1)}</span></td>
                <td>${orderData.quantity}</td>
                <td>$${orderData.price || 'Market'}</td>
                <td>${orderData.orderType.charAt(0).toUpperCase() + orderData.orderType.slice(1)}</td>
                <td><span class="badge bg-warning">Pending</span></td>
                <td>
                    <button class="btn btn-outline-danger btn-sm" onclick="cancelOrder('${orderId}')">
                        <i class="fas fa-times"></i>
                    </button>
                </td>
            `;
        }

        // Real-time price updates (simulated)
        setInterval(function() {
            // This would normally connect to a real-time data feed
            const prices = document.querySelectorAll('td:nth-child(3)');
            prices.forEach(priceCell => {
                const currentPrice = parseFloat(priceCell.textContent.replace('$', ''));
                const change = (Math.random() - 0.5) * 2; // Random change
                const newPrice = currentPrice + change;
                priceCell.textContent = '$' + newPrice.toFixed(2);
            });
        }, 5000);
    </script>
</body>
</html>